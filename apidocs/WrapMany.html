<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class WrapMany - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-method_missing">#method_missing</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-WrapMany">
  <h1 id="class-WrapMany" class="class">
    class WrapMany
  </h1>

  <section class="description">
    
<p>Adapted from <a
href="https://gist.github.com/1120383">gist.github.com/1120383</a></p>

<p>Wraps multiple objects in a single object. Method calls are resolved by
cycling through all wrapped objects, in the order they were specified on
the constructor, looking for the appropriate named method. Useful for
temporarily adding methods to an instance, without monkeypatching the
class.</p>

<p><a href="WrapMany.html">WrapMany</a> has special-case logic for OpenStruct
objects, Hash objects and object fields. Hash keys, OpenStruct fields, and
public instance variables will be resolved, but only for calls made with no
parameters.</p>

<p>Example 1: Add an “age” value to a User object using an OpenStruct</p>

<pre>require &#39;ostruct&#39;
require &#39;grizzled/wrapmany&#39;

age_holder = OpenStruct.new(:age =&gt; 43)
u = User.find(...)
user_with_age = WrapMany.new(u, age_holder)</pre>

<p>Example 2: Add an “age” value to a User object using a hash</p>

<pre>require &#39;grizzled/wrapmany&#39;

u = User.find(...)
user_with_age = WrapMany.new(u, {:age =&gt; 43})</pre>

<p>Example 3: Add an “age” value to a User object using another class</p>

<pre>require &#39;grizzled/wrapmany&#39;

class AgeHolder
    def initialize(age)
        @age = age
    end
end

u = User.find(...)
user_with_age = WrapMany.new(u, AgeHolder.new(43))</pre>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/grizzled/wrapmany.rb, line 44</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-comment"># Map any OpenStruct objects in the arguments to hashes, and add the</span>
  <span class="ruby-comment"># current object (in case someone subclasses this class)</span>
  <span class="ruby-ivar">@objects</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">map</span> {
    <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">OpenStruct</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-string">&quot;@table&quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">a</span>
  } <span class="ruby-operator">+</span> [<span class="ruby-keyword">self</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-method_missing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">method_missing</span><span
            class="method-args">(meth, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="method_missing-source">
            <pre><span class="ruby-comment"># File lib/grizzled/wrapmany.rb, line 52</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">method_missing</span>(<span class="ruby-identifier">meth</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">method_name</span> = <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">to_s</span>

  <span class="ruby-comment"># Loop through all objects, looking for something that satisfies the</span>
  <span class="ruby-comment"># method name.</span>
  <span class="ruby-ivar">@objects</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span><span class="ruby-operator">|</span>

    <span class="ruby-comment"># First determine if the method exists as a public instance method.</span>
    <span class="ruby-comment"># If so, call it.</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">public_instance_methods</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">method_name</span>.<span class="ruby-identifier">to_sym</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">method_name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># Otherwise, if there are no arguments, then check for fields and</span>
    <span class="ruby-comment"># hash keys</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">instance_variables</span>.<span class="ruby-identifier">include?</span> <span class="ruby-node">&quot;:@#{method_name}&quot;</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">instance_variable_get</span> <span class="ruby-identifier">method_name</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># Special case for hash</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Hash</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-identifier">meth</span>
          <span class="ruby-keyword">return</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">meth</span>]
        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-identifier">method_name</span>
          <span class="ruby-keyword">return</span> <span class="ruby-identifier">o</span>[<span class="ruby-identifier">method_name</span>]
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">raise</span> <span class="ruby-constant">NoMethodError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;Undefined method: &#39;#{method_name}&#39;&quot;</span>, <span class="ruby-identifier">meth</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

